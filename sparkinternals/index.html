<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta property="twitter:card" content="summary_large_image"/><link rel="shortcut icon" type="image/svg" href="https://media.glassdoor.com/sqll/591152/central-european-university-squarelogo-1430146462267.png"/><noscript></noscript><meta name="generator" content="Gatsby 2.24.85"/><link rel="sitemap" type="application/xml" href="/courseware/sitemap.xml"/><title data-react-helmet="true">Week 5 - Spark Internals</title><link data-react-helmet="true" rel="canonical" href="http://localhost:8000//courseware//sparkinternals"/><meta data-react-helmet="true" name="title" content="Week 5 - Spark Internals"/><meta data-react-helmet="true" name="description" content="Week 5 - Spark Internals"/><meta data-react-helmet="true" property="og:title" content="Week 5 - Spark Internals"/><meta data-react-helmet="true" property="og:description" content="Week 5 - Spark Internals"/><meta data-react-helmet="true" property="twitter:title" content="Week 5 - Spark Internals"/><meta data-react-helmet="true" property="twitter:description" content="Week 5 - Spark Internals"/><link as="script" rel="preload" href="/courseware/webpack-runtime-d9051b0ba854d717e0f5.js"/><link as="script" rel="preload" href="/courseware/framework-c90682c3d94fb45fdc20.js"/><link as="script" rel="preload" href="/courseware/commons-2ef445fb87a62dd81c1d.js"/><link as="script" rel="preload" href="/courseware/app-0f03f9d6df3e68604912.js"/><link as="fetch" rel="preload" href="/courseware/page-data/sparkinternals/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/courseware/page-data/sq/d/2619113677.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/courseware/page-data/sq/d/2619113677.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/courseware/page-data/sq/d/3706406642.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/courseware/page-data/sq/d/3706406642.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/courseware/page-data/sq/d/417421954.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/courseware/page-data/sq/d/417421954.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/courseware/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div><style data-emotion-css="0"></style><div class="navBarWrapper"><nav class="navBarDefault"><div class="navBarHeader"><a href="https://ceu.edu/" class="navBarBrand"><img class="img-responsive displayInline" src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/23/Central_European_University_Logo.svg/1280px-Central_European_University_Logo.svg.png" alt="logo"/></a><div class="headerTitle displayInline"><a href='https://datapao.com/'><img class='img-responsive' src='https://datapao.com/wp-content/themes/datapao/img/footer.svg'/></a></div></div><ul class="socialWrapper visibleMobileView"><li>
		    <a href="https://twitter.com/DE2course" target="_blank" rel="noopener">
		      <div class="twitterBtn">
		        <img src='https://graphql-engine-cdn.hasura.io/learn-hasura/assets/homepage/twitter-brands-block.svg' alt={'Twitter'}/>
		      </div>
		    </a>
		  </li>
			<li>
		    <a href="https://ceu-bizanalytics.slack.com/#/" target="_blank" rel="noopener">
		      <div class="discordBtn">
		        <img src='https://cdn-5dc591f7f911c91c58a5564e.closte.com/wp-content/uploads/2020/03/slack-icon.png' alt={'Slack'}/>
		      </div>
		    </a>
		  </li></ul><div id="navbar" class="topnav"><div class="visibleMobile"><style data-emotion-css="8uxxw2">.css-8uxxw2{width:100%;height:100vh;overflow:auto;position:fixed;padding-left:0px;position:-webkit-sticky;position:-moz-sticky;position:-webkit-sticky;position:sticky;top:0;padding-right:0;-webkit-box-shadow:-1px 0px 4px 1px rgba(175,158,232,0.4);}@media only screen and (max-width:1023px){.css-8uxxw2{width:100%;height:100vh;}}@media (min-width:767px) and (max-width:1023px){.css-8uxxw2{padding-left:0;}}@media only screen and (max-width:767px){.css-8uxxw2{padding-left:0px;height:auto;}}</style><aside class="css-8uxxw2 eer5zio1"><div class="sidebarTitle hiddenMobile"><a href='#'>CEU </a><div class='greenCircle'></div><a href='#'>Courseware</a></div><ul class="sideBarUL"><li class="hideFrontLine firstLevel item "><ul><li class=" item "><a href="/courseware/syllabus">Welcome - Syllabus</a></li><li class=" item "><a href="/courseware/internet">Week 1- Internet<button aria-label="collapse" class="collapser"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24"><path d="M7.33 24l-2.83-2.829 9.339-9.175-9.339-9.167 2.83-2.829 12.17 11.996z"></path></svg></button></a></li><li class=" item "><a href="/courseware/aws">Week 2 - AWS<button aria-label="collapse" class="collapser"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24"><path d="M7.33 24l-2.83-2.829 9.339-9.175-9.339-9.167 2.83-2.829 12.17 11.996z"></path></svg></button></a></li><li class=" item "><a href="/courseware/serverless">Week 3 - Serverless<button aria-label="collapse" class="collapser"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24"><path d="M7.33 24l-2.83-2.829 9.339-9.175-9.339-9.167 2.83-2.829 12.17 11.996z"></path></svg></button></a></li><li class=" item "><a href="/courseware/apachespark">Week 4 - Apache Spark<button aria-label="collapse" class="collapser"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24"><path d="M7.33 24l-2.83-2.829 9.339-9.175-9.339-9.167 2.83-2.829 12.17 11.996z"></path></svg></button></a></li><li class=" item "><a aria-current="page" class="" href="/courseware/sparkinternals">Week 5 - Spark Internals<button aria-label="collapse" class="collapser"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24"><path d="M7.33 24l-2.83-2.829 9.339-9.175-9.339-9.167 2.83-2.829 12.17 11.996z"></path></svg></button></a></li><li class=" item "><a href="/courseware/sparkAPI">Week 6 - Apache Spark APIs<button aria-label="collapse" class="collapser"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24"><path d="M7.33 24l-2.83-2.829 9.339-9.175-9.339-9.167 2.83-2.829 12.17 11.996z"></path></svg></button></a></li><li class=" item "><a href="/courseware/spark-continued">Week 7 - Apacke Spark Hands-on<button aria-label="collapse" class="collapser"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24"><path d="M7.33 24l-2.83-2.829 9.339-9.175-9.339-9.167 2.83-2.829 12.17 11.996z"></path></svg></button></a></li><li class=" item "><a href="/courseware/bigdatahistory">Big Data History [Optional Reading]</a></li><li class=" item "><a href="/courseware/resources">Resources/Help</a></li></ul></li><style data-emotion-css="1q387v1">.css-1q387v1{list-style:none;padding:0.5rem 0;}.css-1q387v1 hr{margin:0;padding:0;border:0;border-bottom:1px solid #ede7f3;}</style><li class="css-1q387v1 eer5zio2"><hr/></li><style data-emotion-css="1ldulps">.css-1ldulps{list-style:none;}.css-1ldulps a{color:#5c6975;-webkit-text-decoration:none;text-decoration:none;font-weight:400;padding:0.45rem 0 0.45rem 2rem;display:block;position:relative;}.css-1ldulps a:hover{color:#125fb3 !important;}.css-1ldulps a svg{float:right;margin-right:1rem;}</style><li class="css-1ldulps eer5zio0"><a href="http://localhost:8000/" to="http://localhost:8000/" target="_blank" rel="noopener noreferrer"> <!-- -->&lt;- Go Back<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg> </a> </li></ul></aside><hr/></div><ul class="navBarUL navBarNav navBarULRight"><li><a href="https://twitter.com/intent/tweet?&amp;text=Big Data and Cloud Computing Courseware, https://github.com/zoltanctoth/ceu-cloud-bigdata-course" target="_blank" rel="noopener noreferrer"><img class="shareIcon" src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDIzLjAuMywgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IgoJIHZpZXdCb3g9IjAgMCAzNSAyNyIgc3R5bGU9ImVuYWJsZS1iYWNrZ3JvdW5kOm5ldyAwIDAgMzUgMjc7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4KPHN0eWxlIHR5cGU9InRleHQvY3NzIj4KCS5zdDB7ZmlsbC1ydWxlOmV2ZW5vZGQ7Y2xpcC1ydWxlOmV2ZW5vZGQ7ZmlsbDojRkZGRkZGO30KPC9zdHlsZT4KPHBhdGggY2xhc3M9InN0MCIgZD0iTTE3LDcuMmwwLjEsMS4ybC0xLjMtMC4xYy00LjYtMC41LTguNi0yLjQtMTItNS41TDIuMSwxLjFMMS43LDIuM0MwLjgsNC44LDEuMyw3LjUsMy4yLDkuM2MxLDEsMC44LDEuMS0xLDAuNQoJQzEuNyw5LjcsMS4xLDkuNSwxLjEsOS42QzAuOSw5LjgsMS41LDExLjksMiwxMi44YzAuNywxLjIsMiwyLjQsMy41LDMuMWwxLjIsMC41bC0xLjUsMGMtMS40LDAtMS41LDAtMS4zLDAuNQoJYzAuNSwxLjUsMi41LDMuMiw0LjcsMy45bDEuNiwwLjVsLTEuNCwwLjhjLTIsMS4xLTQuNCwxLjctNi44LDEuOEMwLjksMjMuOSwwLDI0LDAsMjQuMWMwLDAuMiwzLjEsMS42LDQuOSwyLjEKCWM1LjQsMS41LDExLjgsMC45LDE2LjYtMS44YzMuNC0xLjksNi44LTUuNiw4LjQtOS4yYzAuOS0xLjksMS43LTUuNSwxLjctNy4xYzAtMS4xLDAuMS0xLjIsMS41LTIuNmMwLjgtMC44LDEuNi0xLjYsMS44LTEuOAoJYzAuMy0wLjUsMC4yLTAuNS0xLjEsMGMtMi4xLDAuNy0yLjUsMC42LTEuNC0wLjVjMC44LTAuOCwxLjctMi4xLDEuNy0yLjVjMC0wLjEtMC40LDAtMC44LDAuM2MtMC41LDAuMi0xLjUsMC42LTIuMiwwLjhsLTEuNCwwLjQKCWwtMS4yLTAuOGMtMC43LTAuNC0xLjYtMC45LTIuMS0xYy0xLjMtMC4zLTMuMy0wLjMtNC40LDAuMUMxOC44LDEuNCwxNi44LDQuMiwxNyw3LjJ6Ii8+Cjwvc3ZnPgo=" alt="Twitter"/></a></li><li class="divider hiddenMobile"></li><li class="hiddenMobile"><ul class="socialWrapper"><li>
		    <a href="https://twitter.com/DE2course" target="_blank" rel="noopener">
		      <div class="twitterBtn">
		        <img src='https://graphql-engine-cdn.hasura.io/learn-hasura/assets/homepage/twitter-brands-block.svg' alt={'Twitter'}/>
		      </div>
		    </a>
		  </li>
			<li>
		    <a href="https://ceu-bizanalytics.slack.com/#/" target="_blank" rel="noopener">
		      <div class="discordBtn">
		        <img src='https://cdn-5dc591f7f911c91c58a5564e.closte.com/wp-content/uploads/2020/03/slack-icon.png' alt={'Slack'}/>
		      </div>
		    </a>
		  </li></ul></li><li class="githubBtn"><span><a href="https://github.com/zoltanctoth/ceu-cloud-bigdata-course" data-show-count="true" aria-label="Star on GitHub">Star</a></span></li><li><style data-emotion-css="o9dm8b">.css-o9dm8b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:end;-webkit-justify-content:flex-end;-ms-flex-pack:end;justify-content:flex-end;width:100%;padding:0 20px 0 25px;}.css-o9dm8b .switch{position:relative;display:inline-block;width:50px;height:20px;}.css-o9dm8b .switch input{opacity:0;width:0;height:0;}.css-o9dm8b .slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background-color:#ccc;-webkit-transition:0.4s;-webkit-transition:0.4s;transition:0.4s;}.css-o9dm8b .slider:before{position:absolute;content:'';height:30px;width:30px;left:0px;bottom:4px;top:0;bottom:0;margin:auto 0;-webkit-transition:0.4s;-webkit-transition:0.4s;transition:0.4s;box-shadow:0 0px 15px #2020203d;background:white url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAAsQAAALEBxi1JjQAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAOfSURBVEiJlZVLaFxVGMd/333NJG2a+ujUJnGSSWljGvPoQ0tBbIooulDoQgSpEou4UOqiLlzpxoVFEIsgaotaaEhBEXVV8EUXgrao0SYxk6ROjCUxfaQvm8fMPfd+LqZJ5k4ySfxW93yP/+Ocw7mwTOhw21odbG8rzuf6N3fl+iqNDm5rXGreKlXwB1oe8vtr0yanF4JY1YeR2lDzbgnHn5JwxvYJjuhwR7wUjixUXBc3Wfsk/lg7sUYkvmXC1vB+qe3K5IZa90s2cxTNWQASa4B4C0AAfO8kOx8pxnMi4OdaEmbmcg9mIoF7NxLfAiIvSLIrAyChjswpsysg3jy7tEEuLeZgbotUsQL/SjdmIoF4SPl2QM7YNce/mO1xG85+p27dy3lp1XMbIPCrfbGsY0kCM7DxWzWXqgCINQIugh4TQSMuYRRAxSnM/Ss7jvglCfy+1gfwx/bMuhWv/lbR/rp4wLZw88qzPYIcBDIscpazkZdhXf2YMLy1DwnIq1Muxv5eMLCp5zPta6qQTb03oRdVDkO7XYpAdLhtrZkcuoKavIp4MxK7ByDrJDtLXr+VhmWy/oE5cECkfPYzpiNP37ZSIE23pLSvyVtAIGR3RTLizn0ay25ZEXjm3vVGL/wWxCrfU22PXH1LMVXR7lzhYu+y4H+1bjWTf45jV6/Bq38+OF/zTYTAEnUjAzozb0bp0H+eW7cUgdT93o274QxeDQChhK9GCELcy5GJILKsDHxzaFkX4qUJp99F5agrzrWIgFy68SPxM/vnMw6y5glg/uYJctBOHn9nOaLCyJ1/ZqeE4WrLldgHUTkGzY1EU+jb/si+t4oPsFSYkX3PWqqnLJGdAmD+SNzU4PqquQ6rDKl4LOIi70T7FN6wA/crSR2bKaypPmmbUfdBCezXEN0DqC1hgwAEg42Hwmwmcjji1UPZ9lIipxB+Ah1FLR90A3AfcGdBz5dOsnOv5Nmxgv7ENQ2uV0RgynYgXmolu1Ic03YQbJPUiXT+xyGEtnPXw1heGG37Bc2e+9/oAq9I6kQaCp5r2Xz2tHqpA4hb8DwrzHSjUz9COL0icEXftJOd7xeQRcMMNT1ObuxzDafcaMVGvFrw6sC6HWTB6DTwkpPs/KTIzSIqhrauM8GNTzHjuwsfwvkpB6w1IHEQVGV1r+vc8aJsPPXDgtaSXgEd2FXtc/V1gslHLabWa5jzEAXsACm/IVbZz8iqw05Dz8lSGP8BjRZeDZkbZsEAAAAASUVORK5CYII=);background-repeat:no-repeat;background-position:center;}.css-o9dm8b input:checked + .slider{background:linear-gradient(to right,white,#125fb3);}.css-o9dm8b input:checked + .slider:before{-webkit-transform:translateX(24px);-ms-transform:translateX(24px);-webkit-transform:translateX(24px);-ms-transform:translateX(24px);transform:translateX(24px);background:white url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAApgAAAKYB3X3/OAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAANGSURBVEiJndVPbNRVEAfwz9vd/q8tBQtoxSYYDKYmejMGD3DxYloMiRoT22IEDQcPno3xoFclMf6JHrDFyIVEI3g2eiDoRWOMfygqNrSkoeAWCtIu230e3m+77e6KCZO8vH3zZuY7M+/7mxVjVFu7C+vPt7mmh4fi+eEDMUYFVZkdeZU7dhgIzxOj25ULe3fJx6PYamZkDYD4rRDmmgafDIdE3aIJbcrKxkQF4/GtBtuY/43KGVBxOsT/S3YijAomEVBCBe0geNlYfLfBZ3bfJmFlp7u/ONUcYCIMCw6jL1vhFikUURS9Zn88Vn9ZaOJA8DTuA3n0Zjm3ZlDL2VrASpZE8CwaABormAgPC75Cny7cmYE0kwou4Rq4IWeP0fhdc4DjIe+GD0QvIKcbmzOrtl56t9O2gRBYvsKVcyz9ne7nsQgiPhUdtD8uNVYwGRbQK497qu3ZzsYHUuB1EimepTiVKplBGZQM6rI7liFX5/Ur0rPmpYw3ZcEL7fRso3eQQgcCfffT0Z+i9K3GOFMNvh7gWOjDYGpJpuvbkQK1dND/IF1b6Oynf4jW7jU2a3zY6uPQ3whw0/u4S5DYIqsAOjdrkKqutSfbVcncL+ejOoAQsC39VGN9yOiTa8LmXIGOx8h11RxqzzTgeHLOAGKUM4pFFdzMzJYX0n79YiPAP/O0PUSlHTE9cCXdCJ7zVFxZA4DReA4/gKVMd/WvtJcWKf6e6FlapPgHS0UW3uPyN9b58IuxOFU91Ne+E+kL7cb1Oa5O0zPI0kJaa+XaLIszif21q4x2if+1ClLP/iRrUfYNufQTF79P2ceY2lFaZP5HLqaCFaUxmOSsT3RWD42j4mh4RnQEnTZYP+pCLh1Se2uZF0FZdNC0o16Plf8GgMnwOZ5Eot9GiefVmbQiDbtitif52njcUx+q+TSNTgoZQAlzddblJj7ByWah0htc2LvL7L5Nq9r98YhBLSo2481Vfbkh+DtytljWaiy+3QwgxOnhIfl4AmdoGTXw2eUGq8lwWNCDD1WUBC+hYNyLTf9iZ554RAiPG/jyjYKcR7E1wa3sxKkGh/H4Sp3mULNsVyVvTgxTqYIYmRk5oOK0e0/8fEvH25B/AZyRWA6LDlu9AAAAAElFTkSuQmCC);background-repeat:no-repeat;background-position:center;}.css-o9dm8b .slider.round{border-radius:34px;}.css-o9dm8b .slider.round:before{border-radius:50%;}</style><div class="css-o9dm8b e1brsgsc0"><label id="switch" class="switch"><input type="checkbox" id="slider" checked=""/> <span class="slider round"> </span> </label> </div></li></ul></div></nav><style data-emotion-css="1gvjyvp">.css-1gvjyvp{height:60px;box-shadow:0 3px 6px 0 rgba(0,0,0,0.16);background-color:#f8f8f8;position:relative;display:none;}@media (max-width:767px){.css-1gvjyvp{display:block;}}</style><div class="css-1gvjyvp e1ykirhh0"><div class="navBarDefault removePadd"><span class="navBarToggle" role="button" tabindex="0"><span class="iconBar"></span><span class="iconBar"></span><span class="iconBar"></span></span></div></div></div><style data-emotion-css="1orzczj">.css-1orzczj{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;background:#fff;}.css-1orzczj .sideBarUL li a{color:#3B454E;}.css-1orzczj .sideBarUL .item > a:hover{background-color:#125fb3;color:#fff !important;}@media only screen and (max-width:767px){.css-1orzczj{display:block;}}</style><div class="css-1orzczj eso2aao0"><style data-emotion-css="192n44p">.css-192n44p{width:298px;}</style><div class="hiddenMobile css-192n44p eso2aao3"><style data-emotion-css="8uxxw2">.css-8uxxw2{width:100%;height:100vh;overflow:auto;position:fixed;padding-left:0px;position:-webkit-sticky;position:-moz-sticky;position:-webkit-sticky;position:sticky;top:0;padding-right:0;-webkit-box-shadow:-1px 0px 4px 1px rgba(175,158,232,0.4);}@media only screen and (max-width:1023px){.css-8uxxw2{width:100%;height:100vh;}}@media (min-width:767px) and (max-width:1023px){.css-8uxxw2{padding-left:0;}}@media only screen and (max-width:767px){.css-8uxxw2{padding-left:0px;height:auto;}}</style><aside class="css-8uxxw2 eer5zio1"><div class="sidebarTitle hiddenMobile"><a href='#'>CEU </a><div class='greenCircle'></div><a href='#'>Courseware</a></div><ul class="sideBarUL"><li class="hideFrontLine firstLevel item "><ul><li class=" item "><a href="/courseware/syllabus">Welcome - Syllabus</a></li><li class=" item "><a href="/courseware/internet">Week 1- Internet<button aria-label="collapse" class="collapser"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24"><path d="M7.33 24l-2.83-2.829 9.339-9.175-9.339-9.167 2.83-2.829 12.17 11.996z"></path></svg></button></a></li><li class=" item "><a href="/courseware/aws">Week 2 - AWS<button aria-label="collapse" class="collapser"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24"><path d="M7.33 24l-2.83-2.829 9.339-9.175-9.339-9.167 2.83-2.829 12.17 11.996z"></path></svg></button></a></li><li class=" item "><a href="/courseware/serverless">Week 3 - Serverless<button aria-label="collapse" class="collapser"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24"><path d="M7.33 24l-2.83-2.829 9.339-9.175-9.339-9.167 2.83-2.829 12.17 11.996z"></path></svg></button></a></li><li class=" item "><a href="/courseware/apachespark">Week 4 - Apache Spark<button aria-label="collapse" class="collapser"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24"><path d="M7.33 24l-2.83-2.829 9.339-9.175-9.339-9.167 2.83-2.829 12.17 11.996z"></path></svg></button></a></li><li class=" item "><a aria-current="page" class="" href="/courseware/sparkinternals">Week 5 - Spark Internals<button aria-label="collapse" class="collapser"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24"><path d="M7.33 24l-2.83-2.829 9.339-9.175-9.339-9.167 2.83-2.829 12.17 11.996z"></path></svg></button></a></li><li class=" item "><a href="/courseware/sparkAPI">Week 6 - Apache Spark APIs<button aria-label="collapse" class="collapser"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24"><path d="M7.33 24l-2.83-2.829 9.339-9.175-9.339-9.167 2.83-2.829 12.17 11.996z"></path></svg></button></a></li><li class=" item "><a href="/courseware/spark-continued">Week 7 - Apacke Spark Hands-on<button aria-label="collapse" class="collapser"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24"><path d="M7.33 24l-2.83-2.829 9.339-9.175-9.339-9.167 2.83-2.829 12.17 11.996z"></path></svg></button></a></li><li class=" item "><a href="/courseware/bigdatahistory">Big Data History [Optional Reading]</a></li><li class=" item "><a href="/courseware/resources">Resources/Help</a></li></ul></li><style data-emotion-css="1q387v1">.css-1q387v1{list-style:none;padding:0.5rem 0;}.css-1q387v1 hr{margin:0;padding:0;border:0;border-bottom:1px solid #ede7f3;}</style><li class="css-1q387v1 eer5zio2"><hr/></li><style data-emotion-css="1ldulps">.css-1ldulps{list-style:none;}.css-1ldulps a{color:#5c6975;-webkit-text-decoration:none;text-decoration:none;font-weight:400;padding:0.45rem 0 0.45rem 2rem;display:block;position:relative;}.css-1ldulps a:hover{color:#125fb3 !important;}.css-1ldulps a svg{float:right;margin-right:1rem;}</style><li class="css-1ldulps eer5zio0"><a href="http://localhost:8000/" to="http://localhost:8000/" target="_blank" rel="noopener noreferrer"> <!-- -->&lt;- Go Back<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg> </a> </li></ul></aside></div><div class="sidebarTitle sideBarShow"><a href='#'>CEU </a><div class='greenCircle'></div><a href='#'>Courseware</a></div><style data-emotion-css="zj4uvr">.css-zj4uvr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;margin:0px 88px;padding-top:3rem;background:#fff;}.css-zj4uvr table tr{background:#fff;}@media only screen and (max-width:1023px){.css-zj4uvr{padding-left:0;margin:0 10px;padding-top:3rem;}}</style><main class="css-zj4uvr eso2aao1"><style data-emotion-css="14zj307">@media only screen and (max-width:50rem){.css-14zj307{width:100%;position:relative;}}</style><div class="css-14zj307 eso2aao2"><div class="titleWrapper"><style data-emotion-css="1q31z9a">.css-1q31z9a{font-size:32px;line-height:1.5;font-weight:500;border-left:2px solid #125fb3;padding:0 16px;-webkit-flex:1;-ms-flex:1;flex:1;margin-top:0;padding-top:0;color:#000;}</style><h1 class="css-1q31z9a e1uwyxyb0">Week 5 - Spark Internals</h1><style data-emotion-css="qu2iew">.css-qu2iew{padding:1rem 1.5rem;text-align:right;}.css-qu2iew a{font-size:14px;font-weight:500;line-height:1em;-webkit-text-decoration:none;text-decoration:none;color:#555;border:1px solid rgb(211,220,228);cursor:pointer;border-radius:3px;-webkit-transition:all 0.2s ease-out 0s;transition:all 0.2s ease-out 0s;-webkit-text-decoration:none;text-decoration:none;color:rgb(36,42,49);background-color:rgb(255,255,255);box-shadow:rgba(116,129,141,0.1) 0px 1px 1px 0px;height:30px;padding:5px 16px;}.css-qu2iew a:hover{background-color:rgb(245,247,249);}</style><div class="mobileView css-qu2iew e1uwyxyb1"><a href="https://github.com/zoltanctoth/ceu-cloud-bigdata-course/tree/master/sparkinternals.md" class="gitBtn"><img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAyMi4xLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4NCjxzdmcgdmVyc2lvbj0iMS4yIiBiYXNlUHJvZmlsZT0idGlueSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiDQoJIHg9IjBweCIgeT0iMHB4IiB2aWV3Qm94PSIwIDAgMjM1MCAyMzE0LjgiIHhtbDpzcGFjZT0icHJlc2VydmUiPg0KPHBhdGggZD0iTTExNzUsMEM1MjUuOCwwLDAsNTI1LjgsMCwxMTc1YzAsNTUyLjIsMzc4LjksMTAxMC41LDg5MC4xLDExMzkuN2MtNS45LTE0LjctOC44LTM1LjMtOC44LTU1Ljh2LTE5OS44SDczNC40DQoJYy03OS4zLDAtMTUyLjgtMzUuMi0xODUuMS05OS45Yy0zOC4yLTcwLjUtNDQuMS0xNzkuMi0xNDEtMjQ2LjhjLTI5LjQtMjMuNS01LjktNDcsMjYuNC00NC4xYzYxLjcsMTcuNiwxMTEuNiw1OC44LDE1OC42LDEyMC40DQoJYzQ3LDYxLjcsNjcuNiw3Ni40LDE1NS43LDc2LjRjNDEuMSwwLDEwNS43LTIuOSwxNjQuNS0xMS44YzMyLjMtODIuMyw4OC4xLTE1NS43LDE1NS43LTE5MC45Yy0zOTMuNi00Ny01ODEuNi0yNDAuOS01ODEuNi01MDUuMw0KCWMwLTExNC42LDQ5LjktMjIzLjMsMTMyLjItMzE3LjNjLTI2LjQtOTEuMS02MS43LTI3OS4xLDExLjgtMzUyLjVjMTc2LjMsMCwyODIsMTE0LjYsMzA4LjQsMTQzLjljODguMS0yOS40LDE4NS4xLTQ3LDI4NC45LTQ3DQoJYzEwMi44LDAsMTk2LjgsMTcuNiwyODQuOSw0N2MyNi40LTI5LjQsMTMyLjItMTQzLjksMzA4LjQtMTQzLjljNzAuNSw3MC41LDM4LjIsMjYxLjQsOC44LDM1Mi41YzgyLjMsOTEuMSwxMjkuMywyMDIuNywxMjkuMywzMTcuMw0KCWMwLDI2NC40LTE4NS4xLDQ1OC4zLTU3NS43LDQ5OS40YzEwOC43LDU1LjgsMTg1LjEsMjE0LjQsMTg1LjEsMzMxLjlWMjI1NmMwLDguOC0yLjksMTcuNi0yLjksMjYuNA0KCUMyMDIxLDIxMjMuOCwyMzUwLDE2ODkuMSwyMzUwLDExNzVDMjM1MCw1MjUuOCwxODI0LjIsMCwxMTc1LDBMMTE3NSwweiIvPg0KPC9zdmc+DQo=" alt="Github logo"/> Edit on GitHub</a></div></div><style data-emotion-css="1qktglx">.css-1qktglx{max-width:750px;color:#3B454E;}.css-1qktglx ul,.css-1qktglx ol{-webkit-padding-start:40px;-moz-padding-start:40px;-o-padding-start:40px;margin:24px 0px;padding:0px 0px 0px 2em;}.css-1qktglx ul li,.css-1qktglx ol li{font-size:16px;line-height:1.8;font-weight:400;}.css-1qktglx a{-webkit-transition:color 0.15s;transition:color 0.15s;color:#1000EE;}.css-1qktglx code{border:1px solid #ede7f3;border-radius:4px;padding:2px 6px;font-size:0.9375em;background:#fff;}@media (max-width:767px){.css-1qktglx{padding:0 15px;}}</style><div class="css-1qktglx e1uwyxyb2"><h1 class="heading1" id="sparkinternals">Spark Internals</h1><h1 class="heading1" id="introduction">Introduction</h1><p class="paragraph">Spark is a generalized framework for distributed data processing providing functional API for manipulating data at scale, in-memory data caching and reuse across computations. It applies set of coarse-grained transformations over partitioned data and relies on dataset&#x27;s lineage to recompute tasks in case of failures. Worth mentioning is that Spark supports majority of data formats, has integrations with various storage systems and can be executed on Mesos or YARN. </p><p class="paragraph"><em>Powerful and concise API in conjunction with rich library makes it easier to perform data operations at scale. E.g. performing backup and restore of Cassandra column families in Parquet format:</em></p><style data-emotion-css="fkgcw9">.css-fkgcw9{padding:16px;background:rgb(245,247,249);}</style><pre class="css-fkgcw9 eyprwjk0"><pre><pre class="prism-code language-javascript pre" style="color:#9CDCFE;background-color:#1E1E1E" p="3"><div class="token-line"><span class="token plain">def </span><span class="token function" style="color:rgb(220, 220, 170)">backup</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token parameter">path</span><span class="token parameter punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token parameter"> String</span><span class="token parameter punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token parameter"> config</span><span class="token parameter punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token parameter"> Config</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain">  </span></div><div class="token-line"><span class="token plain">  sc</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">cassandraTable</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">config</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">keyspace</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> config</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">table</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">map</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">toEvent</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">toDF</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">write</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">parquet</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">path</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain">def </span><span class="token function" style="color:rgb(220, 220, 170)">restore</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token parameter">path</span><span class="token parameter punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token parameter"> String</span><span class="token parameter punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token parameter"> config</span><span class="token parameter punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token parameter"> Config</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain">  </span></div><div class="token-line"><span class="token plain">  sqlContext</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">read</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">parquet</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">path</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">map</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">toEvent</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">saveToCassandra</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">config</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">keyspace</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> config</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">table</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div></pre></pre></pre><p class="paragraph"><em>Or run discrepancies analysis comparing the data in different data stores:</em></p><pre class="css-fkgcw9 eyprwjk0"><pre><pre class="prism-code language-javascript pre" style="color:#9CDCFE;background-color:#1E1E1E" p="3"><div class="token-line"><span class="token plain">sqlContext</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">sql</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain">  </span></div><div class="token-line"><span class="token plain">  </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;&quot;</span><span class="token plain">&quot;</span></div><div class="token-line"><span class="token plain">     </span><span class="token constant" style="color:rgb(100, 102, 149)">SELECT</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">count</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">     </span><span class="token constant" style="color:rgb(100, 102, 149)">FROM</span><span class="token plain"> cassandra_event_rollups</span></div><div class="token-line"><span class="token plain">     </span><span class="token constant" style="color:rgb(100, 102, 149)">JOIN</span><span class="token plain"> mongo_event_rollups</span></div><div class="token-line"><span class="token plain">     </span><span class="token constant" style="color:rgb(100, 102, 149)">ON</span><span class="token plain"> cassandra_event_rollups</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">uuid</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> cassandra_event_rollups</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">uuid</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">     </span><span class="token constant" style="color:rgb(100, 102, 149)">WHERE</span><span class="token plain"> cassandra_event_rollups</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">value</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">!=</span><span class="token plain"> cassandra_event_rollups</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">value</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;&quot;</span><span class="token plain">&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">stripMargin</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div></pre></pre></pre><p class="paragraph">Spark is built around the concepts of Resilient Distributed Datasets and Direct Acyclic Graph representing transformations and dependencies between them.</p><p class="paragraph"><span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:1035px">
      <a href="/courseware/static/58a42182058c5bf608ca01f93f2701ef/cd536/internal1.png" target="_blank" rel="noopener noreferrer">
    <span class="gatsby-resp-image-background-image" style="padding-bottom:30.888030888030887%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsSAAALEgHS3X78AAABwklEQVQY04WQz2vTcBjGv4KCrsIET/4DPXpeQVA8lXnw4mEUdQcdgj8ognrwKghDexEvHhWZuykMnA7XbuvWrWlqQtY0SZN03/a7tE1/xKY1sbbOx1T0vBee93kPDx8eXhKLxSai0ejJSCQyeWl6OhS//+A4IeRooBOBQuSQAfD/PPJ3h8PhMeBYoMl/Tr58tc5yZv/uulSf21Ta9z4kxccfM6VHK9m9258z5p2c5t58syxPvc/1Z8b5tIEp0cIN3vxxjSQSidOe54UopRPbvHhqHFgttuKaDxTqvyC0AeoCRrOFYs2D0TmAzLqD18vK/KsltcVp9nle1n2NtaE2DkAYY5+63W4jAJq23ew1G1Y8b/pXSwEorTuD3ao/2hDoiFNKo5UMN8yqCorVsv1icWP++YJo5FJPb/XFGTj8lZ+qqQyJ67rF4A8IgGPDwP/+JKv1ZhtDgGM+yh1Ab/6GXKliLS9B3KOQqdl7u1p+trDe3l+T8tfVmoQCE6HUPRCe58/Ztn1REIQLllWLKuLWmW25NStUPCelO5WgIZP3Byyvm0woO0yq9OoS/ba7mKIP36U7yWRBubxjFOiOIbOMVnv5B+3HNV7H/7uNAAAAAElFTkSuQmCC&#x27;);background-size:cover;display:block"></span>
  <img class="gatsby-resp-image-image" alt="internals2" title="internals2" src="/courseware/static/58a42182058c5bf608ca01f93f2701ef/e3189/internal1.png" srcSet="/courseware/static/58a42182058c5bf608ca01f93f2701ef/a2ead/internal1.png 259w,/courseware/static/58a42182058c5bf608ca01f93f2701ef/6b9fd/internal1.png 518w,/courseware/static/58a42182058c5bf608ca01f93f2701ef/e3189/internal1.png 1035w,/courseware/static/58a42182058c5bf608ca01f93f2701ef/cd536/internal1.png 1114w" sizes="(max-width: 1035px) 100vw, 1035px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy"/>
  </a>
    </span></p><p class="paragraph">Spark Application (often referred to as Driver Program or Application Master) at high level consists of SparkContext and user code which interacts with it creating RDDs and performing series of transformations to achieve final result. These transformations of RDDs are then translated into DAG and submitted to Scheduler to be executed on set of worker nodes.</p><h1 class="heading1" id="rdd:resilientdistributeddataset">RDD: Resilient Distributed Dataset</h1><p class="paragraph">RDD could be thought as an immutable parallel data structure with failure recovery possibilities. It provides API for various transformations and materializations of data as well as for control over caching and partitioning of elements to optimize data placement. RDD can be created either from external storage or from another RDD and stores information about its parents to optimize execution (via pipelining of operations) and recompute partition in case of failure.</p><p class="paragraph">From a developer&#x27;s point of view RDD represents distributed immutable data (partitioned data + iterator) and lazily evaluated operations (transformations). As an interface RDD defines five main properties:</p><pre class="css-fkgcw9 eyprwjk0"><pre><pre class="prism-code language-javascript pre" style="color:#9CDCFE;background-color:#1E1E1E" p="3"><div class="token-line"><span class="token comment" style="color:rgb(106, 153, 85)">//a list of partitions (e.g. splits in Hadoop)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">def getPartitions</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token known-class-name class-name" style="color:rgb(78, 201, 176)">Array</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token maybe-class-name">Partition</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">//a list of dependencies on other RDDs</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">def getDependencies</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token maybe-class-name">Seq</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token maybe-class-name">Dependency</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">//a function for computing each split</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">def </span><span class="token function" style="color:rgb(220, 220, 170)">compute</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">split</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token maybe-class-name">Partition</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> context</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token maybe-class-name">TaskContext</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token maybe-class-name">Iterator</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token constant" style="color:rgb(100, 102, 149)">T</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">//(optional) a list of preferred locations to compute each split on</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">def </span><span class="token function" style="color:rgb(220, 220, 170)">getPreferredLocations</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">split</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token maybe-class-name">Partition</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token maybe-class-name">Seq</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token known-class-name class-name" style="color:rgb(78, 201, 176)">String</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token maybe-class-name">Nil</span><span class="token plain"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">//(optional) a partitioner for key-value RDDs</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">val partitioner</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token maybe-class-name">Option</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token maybe-class-name">Partitioner</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token maybe-class-name">None</span><span class="token plain">  </span></div></pre></pre></pre><p class="paragraph">Here&#x27;s an example of RDDs created during a call of method sparkContext.textFile(&quot;hdfs://...&quot;) which first loads HDFS blocks in memory and then applies map() function to filter out keys creating two RDDs:</p><p class="paragraph"><span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:380px">
      <a href="/courseware/static/50deb78b82b57093a9d70422443f0cb4/3f520/internal2.png" target="_blank" rel="noopener noreferrer">
    <span class="gatsby-resp-image-background-image" style="padding-bottom:57.14285714285714%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAAC6klEQVQoz2WSa0iTURjHp5Zt2racps6ZUwsqIyVcTojESyqZBeEHI2QomBJ+KMEVkX4wK/2SH1IJTZNk0ru85CXFzDQkdblbm8b03Zw43XydUu7W0hVP550LRh348xx+B/7nuVEoFAodKQYpCslPsw0UrxOCxEYKRzoaQGdSPXy/j6/fMRS5nrcwpJNIwZS7FbeP1z8UXnpQWXH+THL6AW+3RD6fkVNyPyXjRnUmP/vqib88TSB0f5Z1vTQuu6wuI7NQmOS/zyfSnZxGt9o5rLTB9JzRUCLIS0QwiUqlpaDIS8q5liPXL5ptLgJ6JMoaxHwC6fR0BpNxinTEPk69tP5cA9mylmgGCHT/JlXrxI8xHERDis1qYfFpMu2g4BAOiozEXEG6RDnhhF0NiEbHmhDzj+RGcTicMLLMgNaergFwfAElrrDffAfBbsNlgwnDtwCWjBZiTTMV5l1yq8QYJzNt2My/7TC8YKyj/HNGtesiYtcCn/QrlqqhNZYbTitwrKJFDU3i6c1bxXk8ssF0JpNsdgiXl5E183nIAa55aHvT+wwxJjuCzQ0NZZEDZDW0twzCDxnMa2XW4gnYM1xZNWEGC8AKYSMInTTUO4NO1bc46fqW3eRywAhO/JfhB/2maG3HBpNLBkvNyOqe4axahz3CtNDxVmGuLC+MR+gQK+QwuSr0+Kz8VIli3AG/cOgYHmlEjBodG8PmcMLJHgY2i1/1g1MNKp3SWjrmyVCjM2Bjc3aYVhk2XjTUxCLkm8DjuydWUtt2VqJdsFtcZuiWqJ6Q7MLlK4H8c/wA8t4zIxd/dxphRodb7r237Rl+xQ1Yv8wOk8rVjb6O+miSJaek0chYUNXIk2rnHbtAQJ9U7TbMLyqiXczNdi/468mZLqfLADL9orV8xOkpWYVjtZgGOgZmzXfKChLIZqO1iSAHwMsVpE7Jx+0u+xy0Dw49RYx2JJobwWaHki05+Ly7q3fHIgfZgmy7bAKCSL8/kuReOHgS7dcAAAAASUVORK5CYII=&#x27;);background-size:cover;display:block"></span>
  <img class="gatsby-resp-image-image" alt="internals2" title="internals2" src="/courseware/static/50deb78b82b57093a9d70422443f0cb4/3f520/internal2.png" srcSet="/courseware/static/50deb78b82b57093a9d70422443f0cb4/a2ead/internal2.png 259w,/courseware/static/50deb78b82b57093a9d70422443f0cb4/3f520/internal2.png 380w" sizes="(max-width: 380px) 100vw, 380px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy"/>
  </a>
    </span></p><ul><li>HadoopRDD:<ul><li>getPartitions = HDFS blocks</li><li>getDependencies = None</li><li>compute = load block in memory</li><li>getPrefferedLocations = HDFS block locations</li><li>partitioner = None</li></ul></li><li>MapPartitionsRDD<ul><li>getPartitions = same as parent</li><li>getDependencies = parent RDD</li><li>compute = compute parent and apply map()</li><li>getPrefferedLocations = same as parent</li><li>partitioner = None<!-- -->  RDD Operations
Operations on RDDs are divided into several groups:</li></ul></li></ul><h1 class="heading1" id="transformations">Transformations</h1><ul><li>apply user function to every element in a partition (or to the whole partition) </li><li>apply aggregation function to the whole dataset (groupBy, sortBy)</li><li>introduce dependencies between RDDs to form DAG</li><li>provide functionality for repartitioning (repartition, partitionBy)</li></ul><h1 class="heading1" id="actions">Actions</h1><ul><li>trigger job execution</li><li>used to materialize computation results</li></ul><h1 class="heading1" id="extra:persistence">Extra: persistence</h1><ul><li>explicitly store RDDs in memory, on disk or off-heap (cache, persist)</li><li>checkpointing for truncating RDD lineage</li><li>Here&#x27;s a code sample of some job which aggregates data from Cassandra in lambda style combining previously rolled-up data with the data from raw storage and demonstrates some of the transformations and actions available on RDDs:</li></ul><pre class="css-fkgcw9 eyprwjk0"><pre><pre class="prism-code language-javascript pre" style="color:#9CDCFE;background-color:#1E1E1E" p="3"><div class="token-line"><span class="token comment" style="color:rgb(106, 153, 85)">//aggregate events after specific date for given campaign</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">val events </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">  </span></div><div class="token-line"><span class="token plain">    sc</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">cassandraTable</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;demo&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;event&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">map</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">toEvent</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">                                </span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">filter</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> </span><span class="token parameter">e</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(212, 212, 212)">=&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        e</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">campaignId</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token plain"> campaignId </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;&amp;</span><span class="token plain"> e</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">time</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">isAfter</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">watermark</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">keyBy</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">eventType</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">reduceByKey</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">_ </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"> _</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">                                        </span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">cache</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">                                            </span></div></pre></pre></pre><pre class="css-fkgcw9 eyprwjk0"><pre><pre class="prism-code language-javascript pre" style="color:#9CDCFE;background-color:#1E1E1E" p="3"><div class="token-line"><span class="token comment" style="color:rgb(106, 153, 85)">//aggregate campaigns by type</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">val campaigns </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">  </span></div><div class="token-line"><span class="token plain">    sc</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">cassandraTable</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;demo&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;campaign&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">map</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">toCampaign</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">filter</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> </span><span class="token parameter">c</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(212, 212, 212)">=&gt;</span><span class="token plain"> </span></div><div class="token-line"><span class="token plain">         c</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">id</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token plain"> campaignId </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;&amp;</span><span class="token plain"> c</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">time</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">isBefore</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">watermark</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">keyBy</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">eventType</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">reduceByKey</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">_ </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"> _</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">cache</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div></pre></pre></pre><pre class="css-fkgcw9 eyprwjk0"><pre><pre class="prism-code language-javascript pre" style="color:#9CDCFE;background-color:#1E1E1E" p="3"><div class="token-line"><span class="token comment" style="color:rgb(106, 153, 85)">//joined rollups and raw events</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">val joinedTotals </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> campaigns</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">join</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">events</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">  </span></div><div class="token-line"><span class="token plain">           </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">map</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">case</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token parameter">key</span><span class="token parameter punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token parameter"> </span><span class="token parameter punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token parameter">campaign</span><span class="token parameter punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token parameter"> event</span><span class="token parameter punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(212, 212, 212)">=&gt;</span><span class="token plain"> </span></div><div class="token-line"><span class="token plain">             </span><span class="token function maybe-class-name" style="color:rgb(220, 220, 170)">CampaignTotals</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">campaign</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> event</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span></div><div class="token-line"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">           </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">collect</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div></pre></pre></pre><pre class="css-fkgcw9 eyprwjk0"><pre><pre class="prism-code language-javascript pre" style="color:#9CDCFE;background-color:#1E1E1E" p="3"><div class="token-line"><span class="token comment" style="color:rgb(106, 153, 85)">//count totals separately</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">val eventTotals </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">  </span></div><div class="token-line"><span class="token plain">    events</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">map</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">case</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token parameter">t</span><span class="token parameter punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token parameter"> e</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(212, 212, 212)">=&gt;</span><span class="token plain"> s</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;$t -&gt; ${e.value}&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">collect</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div></pre></pre></pre><pre class="css-fkgcw9 eyprwjk0"><pre><pre class="prism-code language-javascript pre" style="color:#9CDCFE;background-color:#1E1E1E" p="3"><div class="token-line"><span class="token plain">val campaignTotals </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">  </span></div><div class="token-line"><span class="token plain">    campaigns</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">map</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">case</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token parameter">t</span><span class="token parameter punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token parameter"> e</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(212, 212, 212)">=&gt;</span><span class="token plain"> s</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;$t -&gt; ${e.value}&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">collect</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div></pre></pre></pre><p class="paragraph"><span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:899px">
      <a href="/courseware/static/d97e91a3d9a1bc8aaf423e4038ee27cc/681f1/internal3.png" target="_blank" rel="noopener noreferrer">
    <span class="gatsby-resp-image-background-image" style="padding-bottom:27.7992277992278%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsSAAALEgHS3X78AAABsUlEQVQY02PgFRDkZWPnEGPAAKyCQEIEiIXQJHiBWBQkzsTEzIokzg/EXAwbr72o2XDlmfu6i4+v7bj73hAkc/bO5e07ThyxWn78qsiyAyck1x0/p/jv/38mkNy6U5/Y52y9KTF/x11BmEnrD98X3nX2udyuM89lGKZvO2bVtXyr/srTd71aZi8R8q9eKHD94ZVfvTOnJhw6c/DEnosXF155eP3BxMUrNEGa522/FTJxxcn/U9acOwAz8NqDdysePH37/8bdp98YNl1/2bD5+quDMGdLKGlpXLh1ttw/IsJ+95EdN/ZeurTw2uMb9zPLqqyB8mJN07dmLd3/9P/EFaeuAvkgV0peu/dq8+evP/4/ffHmP8PKM3dNV5y+47v4yFV2kIkNO57y3Xh87VnLhN7Yfcd2Xd19/tyKy/cvvdpz6boiSH7FoRch609//r/yyJv9MBdevvNq/skzl76fv3zzOcPW228bd9z9sHPyxgOgwGZo2fOS5+Ldi+c37t/puv/iOc3t5y5oHrt+2XLh9r0cIPk1x9/yLD/0UmPF4VeyMAPXHXspvPHUO7nVR57LAAAHw9l3UHM+NgAAAABJRU5ErkJggg==&#x27;);background-size:cover;display:block"></span>
  <img class="gatsby-resp-image-image" alt="internals3" title="internals3" src="/courseware/static/d97e91a3d9a1bc8aaf423e4038ee27cc/681f1/internal3.png" srcSet="/courseware/static/d97e91a3d9a1bc8aaf423e4038ee27cc/a2ead/internal3.png 259w,/courseware/static/d97e91a3d9a1bc8aaf423e4038ee27cc/6b9fd/internal3.png 518w,/courseware/static/d97e91a3d9a1bc8aaf423e4038ee27cc/681f1/internal3.png 899w" sizes="(max-width: 899px) 100vw, 899px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy"/>
  </a>
    </span></p><p class="paragraph">Here&#x27;s a quick recap on the execution workflow before digging deeper into details: user code containing RDD transformations forms Direct Acyclic Graph which is then split into stages of tasks by DAGScheduler. Stages combine tasks which dont require shuffling/repartitioning if the data. Tasks run on workers and results then return to client.</p><p class="paragraph"><span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:1024px">
      <a href="/courseware/static/57227902ccfb1ab66de27f4446c632f2/2bef9/internal4.png" target="_blank" rel="noopener noreferrer">
    <span class="gatsby-resp-image-background-image" style="padding-bottom:42.857142857142854%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsSAAALEgHS3X78AAACe0lEQVQoz2PIyqtQmrpssdbMFctsGICgbcoUrfnrVjuA2DMXNLku3zhFHsT+//8/kGRkCEvNZOicPpXROzyGoaynn7GyfxJImqGibyKYZpi0YJ/PobP7Gk5dPbkBxN9+eFfZqctHjgCZLEf21V44daI7FWSShCADHwMOUN7SzRARHsbQ0NDAwDB31TH3I5eOVp26dnYVSHL/2WN5h88dOgxkSuzf03z2yNEJySDxkKRkKSDFpGNmy+IemSysbmjB5OAfLubgH8EG8wEQMzL0z9kWvOfEnq6jF0/sAUls3r+j7sj5w5eATPZ9uxsfnjzRk1TQulTu2MWjh9mFZIVTi0q0gL7ZG5aYqrj5wrkd68+cdoI6lAVMzlq4WX7Dob2GG/bvcQPx1x3Yp71h/y5/EHvj9kkhLW0JKj2zZlsBffCQV1ZXoKKjS+vcrQt347MLVHbfvHFtwf4Dnnt2bU84f/Pc1VsPbi5gqGycYrl254agbYf3FIC8NGfFYv99pw5WgMNze2vz2jUV5u3T5pqevHrqOZ+srmBpS5vO2ZvnHgENVN11/dqtJYcO++zcttn74u0Lq27cu97IMHvlcd+jFw+3nb5+dhfIkL2nDlUdv3gE5GX+g3sbHpw+2Z2UWLlE8vil46t4lKzYW6fPkjl9/cyS/Npmse1XLs/ddP6cJUoMAQ10P3b5aBXQQHCkHDh3LO8IJFJEDuxpOHfsWF8yAwFw9c5lpoef7zF9+/+FiaFn9g6fA6d21R+/dGwdSHLrgW0lpy4dPgBiH95bc+b82b5EEPvyqV4WQRl1BhkxboaPx5sZ1NRUGdZv72fYuH8R2ND9B/YybNmyhQEAiCgpwhiwAzcAAAAASUVORK5CYII=&#x27;);background-size:cover;display:block"></span>
  <img class="gatsby-resp-image-image" alt="internals4" title="internals4" src="/courseware/static/57227902ccfb1ab66de27f4446c632f2/2bef9/internal4.png" srcSet="/courseware/static/57227902ccfb1ab66de27f4446c632f2/a2ead/internal4.png 259w,/courseware/static/57227902ccfb1ab66de27f4446c632f2/6b9fd/internal4.png 518w,/courseware/static/57227902ccfb1ab66de27f4446c632f2/2bef9/internal4.png 1024w" sizes="(max-width: 1024px) 100vw, 1024px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy"/>
  </a>
    </span></p><p class="paragraph">Here&#x27;s a DAG for the code sample above. So basically any data processing workflow could be defined as reading the data source, applying set of transformations and materializing the result in different ways. Transformations create dependencies between RDDs and here we can see different types of them.</p><p class="paragraph">The dependencies are usually classified as &quot;narrow&quot; and &quot;wide&quot;:
<span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:430px">
      <a href="/courseware/static/19e50b90739321db1ddea3402f865545/05ed2/internal6.png" target="_blank" rel="noopener noreferrer">
    <span class="gatsby-resp-image-background-image" style="padding-bottom:154.05405405405406%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,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&#x27;);background-size:cover;display:block"></span>
  <img class="gatsby-resp-image-image" alt="internals6" title="internals6" src="/courseware/static/19e50b90739321db1ddea3402f865545/05ed2/internal6.png" srcSet="/courseware/static/19e50b90739321db1ddea3402f865545/a2ead/internal6.png 259w,/courseware/static/19e50b90739321db1ddea3402f865545/05ed2/internal6.png 430w" sizes="(max-width: 430px) 100vw, 430px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy"/>
  </a>
    </span></p><ul><li>Narrow (pipelineable)<ul><li>each partition of the parent RDD is used by at most one partition of the child RDD</li><li>allow for pipelined execution on one cluster node</li><li>failure recovery is more efficient as only lost parent partitions need to be recomputed</li></ul></li><li>Wide (shuffle)</li><li>multiple child partitions may depend on one parent partition</li><li>require data from all parent partitions to be available and to be shuffled across the nodes</li><li>if some partition is lost from all the ancestors a complete recomputation is needed</li></ul><h1 class="heading1" id="splittingdagintostages">Splitting DAG into Stages</h1><p class="paragraph">Spark stages are created by breaking the RDD graph at shuffle boundaries
<span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:865px">
      <a href="/courseware/static/d456a0f56faf8e4acd4c81afdb395ccd/79e48/internal7.png" target="_blank" rel="noopener noreferrer">
    <span class="gatsby-resp-image-background-image" style="padding-bottom:59.84555984555985%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsSAAALEgHS3X78AAADF0lEQVQoz41Ta0iTYRR+t2lqRVOzKU7NRM28pliMcAnZBQTpRyXhpX6ZKQpaFLpSQXTalve8tmIO0XRq0y01r7vknNu+uU/n/HQXVyli/QrDH4G8fa8Q/SnrwOE873nPe96H83AAAMCVdC9wsKH7wzR6AI2MTgc4DYjHdNzaYVuGV+XWSeWy6dXFRkfog6ENtsI4304WOHd0FJ6fUdY1B2TZnMkzxSfsHGpK/Ys7gSEFYRNOOuoiK5SBa9sOmNVFxDZPr6QuWBYgWeBXz0u/p9bU7Lnx4WlEVbwOqQ4IKQhrIQQbEFIhGeVkDqK8VLmiE48ZStnhwAO34t/K+LyQnkHRZYzAvpBvIouLU/NMWJWV8WQ7DJRBJviXSeRme/eokZ9wNYKxtrkKOQ2C8K7hgRTDqh4x9OdVZeYYtZW719L5dHDLwiySbST2aYkowIKHkrt/nBjGlpOCXkB6vepTjAw3RYP+Uc1T0aDiuncw02Nar25Iyy9iVjQ1Ro3PK2vRTFraHsYqVA3czEtxR9AMO1RW/YxpSQLAlusdkSVZZ1mGCdXmWKHeKlE5rJJfRF3+xB7C3ziIo/MEIXNB5Ecy3IIJUa7pdUf0og3fqS/NZciM+jaFw94PeqQfHj97Y7hxvGTVdwo3VrP5S6cKxGvxE7rZCqScUJAf8U7eXk7nwgjURK6dGTGsGXsR5ovE8Yv2xb0Sbi1Tii8IlR/tUjAkN1vaRtcbg8rmz5g37fBmu5nFHSEy9AS2rzK/OjNbq6neZRdOeqImExrFS/WipgFhTk1TDFlnzsrJ8xXPqXkzNmsrkKlW9G/HDaWJfsDdaMV3uDXc4N6B10l6wvAVqczh3M7Dsdp11t2XHmimnM5pt7yWkf0RXU27Ty0QTB0F7gwKp3XIpVw05YoY2kiVeawr0QziMwGL6gXhnZL+FIzYVzmwqjIj16jlfmc/0tHB/5j4PdbYJZ1Pj2H5H5sz6cQFFc+Zgr7uWNXCbA9aJYGg8IJaVSU8mz2NVpQSGh3n5ON/Em0LzfmQCy0wNNyJQqHSvJkBNE+Gj/NPuW1v2bvbY9QAAAAASUVORK5CYII=&#x27;);background-size:cover;display:block"></span>
  <img class="gatsby-resp-image-image" alt="internals7" title="internals7" src="/courseware/static/d456a0f56faf8e4acd4c81afdb395ccd/79e48/internal7.png" srcSet="/courseware/static/d456a0f56faf8e4acd4c81afdb395ccd/a2ead/internal7.png 259w,/courseware/static/d456a0f56faf8e4acd4c81afdb395ccd/6b9fd/internal7.png 518w,/courseware/static/d456a0f56faf8e4acd4c81afdb395ccd/79e48/internal7.png 865w" sizes="(max-width: 865px) 100vw, 865px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy"/>
  </a>
    </span></p><ul><li>RDD operations with &quot;narrow&quot; dependencies, like map() and filter(), are pipelined together into one set of tasks in each stage operations with shuffle dependencies require multiple stages (one to write a set of map output files, and another to read those files after a barrier).</li><li>In the end, every stage will have only shuffle dependencies on other stages, and may compute multiple operations inside it.    - The actual pipelining of these operations happens in the RDD.compute() functions of various RDDs</li></ul><p class="paragraph">There are two types of tasks in Spark: <code>ShuffleMapTask</code> which partitions its input for shuffle and <code>ResultTask</code> which sends its output to the driver. The same applies to types of stages: <code>ShuffleMapStage</code> and <code>ResultStage</code> correspondingly.</p><h1 class="heading1" id="shuffle">Shuffle</h1><ul><li><p class="paragraph">During the shuffle ShuffleMapTask writes blocks to local drive, and then the task in the next stages fetches these blocks over the network.</p></li><li><p class="paragraph">Shuffle Write</p><ul><li>redistributes data among partitions and writes files to disk</li><li>each hash shuffle task creates one file per reduce task (total = MxR)</li><li>sort shuffle task creates one file with regions assigned to reducer</li><li>sort shuffle uses in-memory sorting with spillover to disk to get final result</li></ul></li><li><p class="paragraph">Shuffle Read</p><ul><li>fetches the files and applies reduce() logic</li><li>if data ordering is needed then it is sorted on reducer side for any type of shuffle</li></ul></li></ul><p class="paragraph">In Spark <strong>Sort Shuffle</strong> is the default one.
Sort Shuffle:
<span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:706px">
      <a href="/courseware/static/46a7536b3299b59c3063ffb37bd48daf/9f21b/internal8.png" target="_blank" rel="noopener noreferrer">
    <span class="gatsby-resp-image-background-image" style="padding-bottom:62.934362934362944%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAADm0lEQVQ4y2NgAAJpKUkhAX4+BR4ebilubm5JT09PlqCgIOb///8z7tq1i/HatWuMMTExzO7u7iyeHh4sBSUVTGHh0ZyyUlIqKsoKMgoK8opa2lriP/5/Z2TgFxBRZGBkV2Bh5ZK3sbUXdXdz4/fw8OCxt7fnk5GRUZQFAikpKXkjIyPBqKgoTh9fPy4PN1cZoDtYgZgJSrOAHKajqSPA0F6XKnDt+Fyeo9u6udatnAGSRAZMxsbGPEAsYmlpye/h6cnrYG3KGZucoXL+6hPbL5fOelw+uib49u2LgVefXvecPHOiBsPXFweuPbu19cH3V4fuHN890xNoiKKOtqaWkpKSJhCo2tjYiPLy8gowMjLqs7NzqIMsCU3I8rpy89n//w/v/P//6SIwZP79f/337f9dh3fmM7y4vdnsxa1Npt+e7zHZsqpXVFBUjtvK0pzPxMSET09PjxMYnvz6+vryQAtUNTQ0lDVU5EUSMvINzlx+lPHs6MHMW2c25z94cD3v9M0zWXMWzTJkePdwp8fLO1s8vr/c775rwyRpNi5RHnNzUwFDQ0MBXV1dHjc3NwE7OztRoIGKmlpa8hYG6jyxKTkmQAMLX5863njr5Prehw+udF+4d7Fz1eaVzgxfnu2/8PTmlpvfXh68emz3THegl+R1dDQ1gQYAHaShYmVlJcbDwyPOxMRkyMHBqQmKhOjUfO8L1x5/+Hfz2v//r04Dvfz1/5u/7/7vOba7CiUGbJwjmNEihcHBwYHTxcWFD+hSHqD3eS3NTLhjE1IUdx25KvPqzEn5vRvmah46uEPt+tOb8uXVZTIMj66ulfnydIf0z5e7JLevm8ajqGbM7OnhAkpzzIGBgYze3t5cPj4+PECX8jo4OvGZ66txJKbnaZ669NDn1anj4af3LEm9dvVUEtDL0XOWzDZk+Pby0OMXd7a/+fn68IvT++d6Ax2lZKCvq6+mpqYHjGUNa2trCWA6lObg4LDg4+c3BMpzRCXn+p+/9uTT/7u3/v9/dx7o5Z//P/z/9H/v8d3VDFtWdettXN6uu3fTRJ3SgmQpM3NrYScnRxGgV0WBkSHs5eUlBUyDKsAY1wLGvLqFqbFMXEq2zq6DZ5NObVhbefHQ6vJLF4+Xbzu4vXbmghlW6EHG0NxQyZiXX8hYUVHBWFRUxJiQkIAif+vtf3Qt7EDMBecB3QvHxILE4jaQesa82Bh2AT4eEwEBfiMzK3M+kBwA7WFknVMMNiIAAAAASUVORK5CYII=&#x27;);background-size:cover;display:block"></span>
  <img class="gatsby-resp-image-image" alt="internals8" title="internals8" src="/courseware/static/46a7536b3299b59c3063ffb37bd48daf/9f21b/internal8.png" srcSet="/courseware/static/46a7536b3299b59c3063ffb37bd48daf/a2ead/internal8.png 259w,/courseware/static/46a7536b3299b59c3063ffb37bd48daf/6b9fd/internal8.png 518w,/courseware/static/46a7536b3299b59c3063ffb37bd48daf/9f21b/internal8.png 706w" sizes="(max-width: 706px) 100vw, 706px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy"/>
  </a>
    </span></p><ul><li>Incoming records accumulated and sorted in memory according their target partition ids</li><li>Sorted records are written to file or multiple files if spilled and then merged</li><li>index file stores offsets of the data blocks in the data file</li></ul><h1 class="heading1" id="sparkcomponents">Spark Components</h1><ul><li><p class="paragraph">At 10K foot view there are three major components:
<span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:543px">
      <a href="/courseware/static/1bd78677654f383d1ccaf58ff5041ca3/29579/internal9.png" target="_blank" rel="noopener noreferrer">
    <span class="gatsby-resp-image-background-image" style="padding-bottom:80.6949806949807%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsSAAALEgHS3X78AAADtElEQVQ4y5VTe0xTZxS/jCkmtBbUbW66+CIqwh6A/iGLE+emE1mMe2jcQ+f+UIxb9siCJpsbYcZtYckmCiKSWWtGb215GPugleLaQntv308upbalDyhtxU6UbB0JZ993Y83YMMtO8ss5Oef8fjnnexDEP6z2opGgmfFsHMuo6AdyfQDk+uAtaZ//dtcNJi0zhHozvSpLnPhPq+ObiPBYghU0uCOHk+MxCAY96Zt+91QkzIDLN0xlenWe1MOFRLok64XaODEy4nsUxw7v0McAIUiFe+BuTAeQtkI45GJwDYAgFJZxQtSXnMF/YGRf4oG/4Yg9gmMFHSyxeTxfUhbqmOJ69zeOAcdxrdW7H8kRI345Ie6PZ5H9iRn8WUX/r83Ka5V52XMjdfGjpC4RQKvYL6sj7nOd9oHmLifTIDLeRLHnZ/mQB9UcqMeLILsgHZyLeV3myZmCAJCFfYdxYrdYf1vcTv3Gb9PEBGcl1kuNEpvgB4FO/GOb4dKFa4ygnb7DRz1CiSFVj3js8XzV0PmvIedweQt4yGfPstUchLyHbMzN5fJYThjf1BNLVmZZ/Hez1xY9u7Bsw0be+vItvGfWb+YUPl/O2VixM3/Hrn15BWuKl2/etitvWUERd1VhCae4bBNbL99SxVtTWLxoU8UrHDzp1so32C0fR8DnsBZhIcK8+by8eTk5OfPv559CWHF/Sk5mrFwOl/e3egFCDrvF3Nz8xzTMveoura9FRoXPkj3MIdyPyUrbeBX6Gefbe5lmGT16ouyF7U+ifBbg1VD9Gh2rkNPRc50ab6PcOHryrYOfrSIaBKo9/cwEaBxx8N4CkFERI+6urqlfrbbGk/2eFFiH/wSNO5Xeubd6RWbCwtIXF6tMMS89dA+MvkmgfL/DJ7WNGwi+kHwvaq6Zdsr3/jHm/h6k1IgKEw5/fbUoZD016lG+C8P6o9OUyxstf/PbZZlLW/0auTRgqWe86vchqD04ZXbZJg58cbWUaBSI3jZb+dMU1ZR2DnSA1BBhP/+h4xfX0ea2qMnUAmZzK/xq949VvlO3HK+M66XbTi3RG0mPxdoKJlPTlNbOTH5YKy4jmoSKA3TIB4bAIDgTMSQY7cGET0+0FKld9jvmaAAw1M7R5EtVR57OCG7d8dFSlcMWssVCQIcGodcZnTpy7PxzRM3JMy+TKqWIVCpIYbfqSt0ZSSUmvb7/85W/KLpbUP4KqezubBarq/FFfHf6J/Yhryt5dfFlqeI0qklQT0drR28NSuf/BRRa+ZhhGoctAAAAAElFTkSuQmCC&#x27;);background-size:cover;display:block"></span>
  <img class="gatsby-resp-image-image" alt="internals9" title="internals9" src="/courseware/static/1bd78677654f383d1ccaf58ff5041ca3/29579/internal9.png" srcSet="/courseware/static/1bd78677654f383d1ccaf58ff5041ca3/a2ead/internal9.png 259w,/courseware/static/1bd78677654f383d1ccaf58ff5041ca3/6b9fd/internal9.png 518w,/courseware/static/1bd78677654f383d1ccaf58ff5041ca3/29579/internal9.png 543w" sizes="(max-width: 543px) 100vw, 543px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy"/>
  </a>
    </span></p></li><li><p class="paragraph">Spark Driver</p><ul><li>separate process to execute user applications</li><li>creates SparkContext to schedule jobs execution and negotiate with cluster manager</li></ul></li><li><p class="paragraph">Executors</p><ul><li>run tasks scheduled by driver</li><li>store computation results in memory, on disk or off-heap</li><li>interact with storage systems</li></ul></li><li><p class="paragraph">Cluster Manager</p><ul><li>Mesos</li><li>YARN</li><li>Spark Standalone</li></ul><p class="paragraph">Spark Driver contains more components responsible for translation of user code into actual jobs executed on cluster:
<span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:845px">
      <a href="/courseware/static/9af5b27e41a3371bc78642287582c4af/8bd7c/internal10.png" target="_blank" rel="noopener noreferrer">
    <span class="gatsby-resp-image-background-image" style="padding-bottom:33.59073359073359%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsSAAALEgHS3X78AAAB5ElEQVQoz4WRS2sTURTHb1oJDd3URyroQrRFitiFSuoiC3HVD+DOD+DeJyjoQhB0pRCEVkptKbRdNNAWLVofhXbEiUYbx7bzSCY388jMbeI8GpJOMqQ9nRsXii76h8M5HA6/c/gfFIlEDobD4aNBdMfj8TYAQAB30B8dOozQkY5WeWEMvVwQQs+TmQPDc2vtx84OIjrfd6a/+8TJnuMPHj0No38VDLTRnJHIXdW0fwiyvlQolhmFVJZml+XTaD8lEokQwzChANSK+YX3rS0b+NdEM2gIWQXUYgmIvQ2LqUL/TAa6hma5+yOvhWv0OoYzz6d5496qSK5/l8o3keM4nwzDYBRFWdE0jTVN8w0F8oo9VLKrsCFhT8qrO7JW9r/wpZ7HYyuXxt8V4NkU60YvP+z8mbdu+7sAxqYNxKlTvwBc1wXLsmgJnlevU6CkV4bd2g6si7iRxUXAht0MgL23nkwOJlkXAg9thHq7skb1hlPZBkGSoeT+Bvq6rjdEUfRqtdqu7/smBa7lyy+sLQ94CTeCCyGnbDY/ppW+V+twauazk06m3OloE0IZ2bmSWhXZ5RS3yBesD4gQMsBxXIxl2RjG+KKm6TEK/Mbro8SqgpBTfTGnAi8bjbdf9XN/+381+v9P9gAv1T/8gDgJ8wAAAABJRU5ErkJggg==&#x27;);background-size:cover;display:block"></span>
  <img class="gatsby-resp-image-image" alt="internals10" title="internals10" src="/courseware/static/9af5b27e41a3371bc78642287582c4af/8bd7c/internal10.png" srcSet="/courseware/static/9af5b27e41a3371bc78642287582c4af/a2ead/internal10.png 259w,/courseware/static/9af5b27e41a3371bc78642287582c4af/6b9fd/internal10.png 518w,/courseware/static/9af5b27e41a3371bc78642287582c4af/8bd7c/internal10.png 845w" sizes="(max-width: 845px) 100vw, 845px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy"/>
  </a>
    </span></p></li><li><p class="paragraph">SparkContext</p><ul><li>represents the connection to a Spark cluster, and can be used to create RDDs, accumulators and broadcast variables on that cluster</li></ul></li><li><p class="paragraph">DAGScheduler</p><ul><li>computes a DAG of stages for each job and submits them to TaskScheduler</li><li>determines preferred locations for tasks (based on cache status or shuffle files locations) and finds minimum schedule to run the jobs</li></ul></li><li><p class="paragraph">TaskScheduler</p><ul><li>responsible for sending tasks to the cluster, running them, retrying if there are failures, and mitigating stragglers</li></ul></li><li><p class="paragraph">SchedulerBackend</p><ul><li>backend interface for scheduling systems that allows plugging in different implementations(Mesos, YARN, Standalone, local)</li></ul></li><li><p class="paragraph">BlockManager</p><ul><li>provides interfaces for putting and retrieving blocks both locally and remotely into various stores (memory, disk, and off-heap)</li></ul></li></ul><h1 class="heading1" id="memorymanagementinspark">Memory Management in Spark</h1><p class="paragraph">Executors run as Java processes, so the available memory is equal to the heap size. Internally available memory is split into several regions with specific functions.</p><p class="paragraph"><span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:264px">
      <a href="/courseware/static/f123e793debaf54ed7be45d8952aafa4/e61aa/internal11.png" target="_blank" rel="noopener noreferrer">
    <span class="gatsby-resp-image-background-image" style="padding-bottom:169.88416988416986%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,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&#x27;);background-size:cover;display:block"></span>
  <img class="gatsby-resp-image-image" alt="internals11" title="internals11" src="/courseware/static/f123e793debaf54ed7be45d8952aafa4/e61aa/internal11.png" srcSet="/courseware/static/f123e793debaf54ed7be45d8952aafa4/a2ead/internal11.png 259w,/courseware/static/f123e793debaf54ed7be45d8952aafa4/e61aa/internal11.png 264w" sizes="(max-width: 264px) 100vw, 264px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy"/>
  </a>
    </span></p><ul><li>Execution Memory<ul><li>storage for data needed during tasks execution</li><li>shuffle-related data</li></ul></li><li>Storage Memory<ul><li>storage of cached RDDs and broadcast variables</li><li>possible to borrow from execution memory (spill otherwise)</li><li>safeguard value is 50% of Spark Memory when cached blocks are immune to eviction</li></ul></li><li>User Memory<ul><li>user data structures and internal metadata in Spark</li><li>safeguarding against OOM</li></ul></li><li>Reserved memory<ul><li>memory needed for running executor itself and not strictly related to Spark</li></ul></li></ul><hr/><h1 class="heading1" id="sourcers/credits:">Sourcers/Credits:</h1><p class="paragraph">To be completed</p></div><div class="addPaddTopBottom"><style data-emotion-css="1594l43">.css-1594l43{margin:0px;padding:0px;width:auto;display:grid;grid-template-rows:auto;-webkit-column-gap:24px;column-gap:24px;grid-template-columns:calc(50% - 8px) calc(50% - 8px);}.css-1594l43 .previousBtn{cursor:pointer;-moz-box-align:center;-moz-box-direction:normal;-moz-box-orient:horizontal;margin:0px;padding:0px;position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;place-self:stretch;border-radius:3px;border:1px solid rgb(230,236,241);-webkit-transition:border 200ms ease 0s;transition:border 200ms ease 0s;box-shadow:rgba(116,129,141,0.1) 0px 3px 8px 0px;-webkit-text-decoration:none;text-decoration:none;background-color:#fff;color:#3B454E;}.css-1594l43 .nextBtn{cursor:pointer;-moz-box-align:center;-moz-box-direction:normal;-moz-box-orient:horizontal;margin:0px;padding:0px;position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;place-self:stretch;border-radius:3px;border:1px solid rgb(230,236,241);-webkit-transition:border 200ms ease 0s;transition:border 200ms ease 0s;box-shadow:rgba(116,129,141,0.1) 0px 3px 8px 0px;-webkit-text-decoration:none;text-decoration:none;background-color:#fff;color:#3B454E;}.css-1594l43 .nextBtn:hover,.css-1594l43 .previousBtn:hover{-webkit-text-decoration:none;text-decoration:none;border:1px solid #125fb3;}.css-1594l43 .nextBtn:hover .rightArrow,.css-1594l43 .previousBtn:hover .leftArrow{color:#125fb3;}.css-1594l43 .leftArrow{display:block;margin:0px;color:rgb(157,170,182);-webkit-flex:0 0 auto;-ms-flex:0 0 auto;flex:0 0 auto;font-size:24px;-webkit-transition:color 200ms ease 0s;transition:color 200ms ease 0s;padding:16px;padding-right:16px;}.css-1594l43 .rightArrow{-webkit-flex:0 0 auto;-ms-flex:0 0 auto;flex:0 0 auto;font-size:24px;-webkit-transition:color 200ms ease 0s;transition:color 200ms ease 0s;padding:16px;padding-left:16px;display:block;margin:0px;color:rgb(157,170,182);}.css-1594l43 .nextPreviousTitle{display:block;margin:0px;padding:0px;-webkit-transition:color 200ms ease 0s;transition:color 200ms ease 0s;}.css-1594l43 .nextPreviousTitle span{font-size:16px;line-height:1.5;font-weight:500;}@media (max-width:767px){.css-1594l43{display:block;padding:0 15px;}.css-1594l43 .previousBtn{margin-bottom:20px;}}</style><div class="css-1594l43 eg6ngbo0"><a class="previousBtn" href="/courseware/apachespark/3-apachespark"><div class="leftArrow"><svg preserveAspectRatio="xMidYMid meet" height="1em" width="1em" fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor" class="_13gjrqj"><g><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></g></svg></div><div class="preRightWrapper"><div class="smallContent"><span>Previous</span></div><div class="nextPreviousTitle"><span>Homework</span></div></div></a><a class="nextBtn" href="/courseware/sparkinternals/1-sparkinternals"><div class="nextRightWrapper"><div class="smallContent"><span>Next</span></div><div class="nextPreviousTitle"><span>Class Resources</span></div></div><div class="rightArrow"><svg preserveAspectRatio="xMidYMid meet" height="1em" width="1em" fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor" class="_13gjrqj"><g><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></g></svg></div></a></div></div></div></main><style data-emotion-css="gqp3x7">.css-gqp3x7{width:224px;}</style><div class="hiddenMobile css-gqp3x7 eso2aao4"><style data-emotion-css="1dq6tsi">.css-1dq6tsi{width:100%;border-right:1px solid #ede7f3;height:100vh;overflow:auto;position:fixed;padding-left:24px;position:-webkit-sticky;position:-moz-sticky;position:-webkit-sticky;position:sticky;top:0;background:#fff;}.css-1dq6tsi .rightSideTitle{font-size:10px;line-height:1;font-weight:700;text-transform:uppercase;-webkit-letter-spacing:1.2px;-moz-letter-spacing:1.2px;-ms-letter-spacing:1.2px;letter-spacing:1.2px;padding:7px 24px 7px 16px;border-left:1px solid #e6ecf1;border-left-color:rgb(230,236,241);color:#3B454E;}.css-1dq6tsi .rightSideBarUL{margin-top:32px;}.css-1dq6tsi .rightSideBarUL li{list-style-type:none;border-left:1px solid #e6ecf1;border-left-color:rgb(230,236,241);}.css-1dq6tsi .rightSideBarUL li a{font-size:12px;font-weight:500;line-height:1.5;padding:7px 24px 7px 16px;color:#3B454E;}@media only screen and (max-width:50rem){.css-1dq6tsi{width:100%;position:relative;}}</style><aside class="css-1dq6tsi e1djfo3h0"><ul></ul></aside></div></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/sparkinternals";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-50eea0acba5bd0bbefbf.js"],"app":["/app-0f03f9d6df3e68604912.js"],"component---src-templates-docs-js":[]};/*]]>*/</script><script src="/courseware/polyfill-50eea0acba5bd0bbefbf.js" nomodule=""></script><script src="/courseware/app-0f03f9d6df3e68604912.js" async=""></script><script src="/courseware/commons-2ef445fb87a62dd81c1d.js" async=""></script><script src="/courseware/framework-c90682c3d94fb45fdc20.js" async=""></script><script src="/courseware/webpack-runtime-d9051b0ba854d717e0f5.js" async=""></script><script defer="">
            function navBarClose() {
              document.getElementById("navbar").classList.toggle("responsive");
            }
            document.addEventListener('click',function(e){
              if(e.target && e.target.tagName.toLowerCase() === 'a'){
                navBarClose();
              }
           });
            </script></body></html>